# Screen: Chat Room (채팅방)

**Route**: `/dashboard/chats/[id]`
**Status**: Archived (Legacy)
**Last Updated**: 2025-12-18
**Priority**: P3
**Dependencies**: Auth, Chat System

---

## 1. 화면 개요

### 목적
프로와 잠재 고객 간의 1:1 채팅 화면.

> **Note**: 채팅 기능은 현재 아카이브 상태입니다. 리드 기반 비즈니스 모델로 전환되어, 직접 연락(카카오톡, 전화)이 주요 소통 수단입니다.

### 사용자 흐름
```
/dashboard/chats → /dashboard/chats/[id] → 메시지 전송
```

### 접근 조건
- **인증 필요**: Yes
- **권한 수준**: pro
- **전제 조건**: 유효한 채팅방 접근 권한

---

## 2. 레이아웃 구조

```
┌────────────────────────────────────────────────────────────────┐
│ [← 뒤로]  김철수                                    [⋮ 더보기]  │
├────────────────────────────────────────────────────────────────┤
│                                                                 │
│                        2024년 1월 15일                          │
│                                                                 │
│  ┌──────────────────────────────┐                              │
│  │ 안녕하세요, 레슨 문의드립니다.  │                              │
│  │ 초보인데 가능할까요?           │  10:30                       │
│  └──────────────────────────────┘                              │
│                                                                 │
│                   ┌──────────────────────────────────┐         │
│          10:32   │ 네, 안녕하세요!                    │         │
│                   │ 초보자 레슨 가능합니다.            │         │
│                   └──────────────────────────────────┘         │
│                                                                 │
│  ┌──────────────────────────────┐                              │
│  │ 주말에도 가능할까요?           │  10:35                       │
│  └──────────────────────────────┘                              │
│                                                                 │
│                   ┌──────────────────────────────────┐         │
│          10:38   │ 네, 토요일 오전에 가능합니다.       │         │
│                   └──────────────────────────────────┘         │
│                                                                 │
├────────────────────────────────────────────────────────────────┤
│ ┌────────────────────────────────────────────────────┐ [전송]  │
│ │ 메시지를 입력하세요...                               │        │
│ └────────────────────────────────────────────────────┘         │
└────────────────────────────────────────────────────────────────┘
```

---

## 3. 주요 컴포넌트

### 3.1 ChatHeader

**채팅 헤더**

| Element | Description |
|---------|-------------|
| 뒤로 버튼 | 채팅 목록으로 이동 |
| 상대방 이름 | 채팅 상대방 이름 |
| 더보기 메뉴 | 차단, 신고, 채팅 나가기 |

### 3.2 MessageList

**메시지 목록**

| Element | Description |
|---------|-------------|
| 날짜 구분선 | "2024년 1월 15일" |
| 메시지 버블 | 내용, 시간 |
| 스크롤 | 최신 메시지로 자동 스크롤 |

### 3.3 MessageBubble

**메시지 버블**

| Type | Style |
|------|-------|
| 받은 메시지 | 좌측, `--tee-surface` 배경 |
| 보낸 메시지 | 우측, `--tee-accent-primary` 배경, 흰 텍스트 |

**Props:**
```typescript
interface MessageBubbleProps {
  content: string;
  timestamp: string;
  isOwn: boolean;
  status?: 'sending' | 'sent' | 'read';
}
```

### 3.4 MessageInput

**메시지 입력**

| Element | Description |
|---------|-------------|
| 텍스트 입력 | 멀티라인 지원 |
| 전송 버튼 | 메시지 전송 |
| 단축키 | Enter로 전송, Shift+Enter로 줄바꿈 |

---

## 4. 데이터 요구사항

### URL Parameters

| Param | Description |
|-------|-------------|
| `id` | 채팅방 ID |

### Server Actions

| Action | 설명 |
|--------|------|
| `getMessages` | 메시지 목록 조회 |
| `sendMessage` | 메시지 전송 |
| `markAsRead` | 읽음 처리 |

### 실시간 업데이트

- Supabase Realtime 사용
- 새 메시지 수신 시 자동 추가
- 읽음 상태 실시간 반영

---

## 5. 인터랙션 정의

### 5.1 메시지 전송

1. **Given** 메시지 입력 필드에 텍스트가 있을 때
2. **When** 전송 버튼을 클릭하거나 Enter를 누르면
3. **Then** 메시지가 UI에 즉시 추가 (낙관적 업데이트)
4. **Then** 서버로 메시지 전송
5. **Then** 전송 성공 시 상태 업데이트

### 5.2 메시지 로드

1. **Given** 채팅방에 진입할 때
2. **Then** 최근 메시지 50개 로드
3. **Then** 최신 메시지로 스크롤
4. **When** 위로 스크롤하면
5. **Then** 이전 메시지 추가 로드

---

## 6. 접근성 요구사항

- [ ] 메시지 영역: `role="log"`, `aria-live="polite"`
- [ ] 입력 필드: 명확한 label
- [ ] 전송 버튼: `aria-label="메시지 전송"`
- [ ] 새 메시지: 스크린 리더 알림

---

## 7. 에러 케이스

| 에러 유형 | 처리 |
|----------|------|
| 전송 실패 | 메시지에 "재전송" 버튼 표시 |
| 연결 끊김 | "연결 중..." 배너 표시 |
| 잘못된 채팅방 | 404 또는 채팅 목록으로 리디렉션 |

---

## 8. 관련 화면

- **이전 화면**: [Chat List](./chat-list.md)
