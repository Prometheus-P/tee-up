# Screen: Payment Fail (결제 실패)

**Route**: `/payment/fail`
**Status**: Unimplemented
**Last Updated**: 2025-12-18
**Priority**: P1
**Dependencies**: Payment System (Stripe/Toss)

---

## 1. 화면 개요

### 목적
결제 과정에서 오류가 발생했을 때 사용자에게 명확한 피드백과 다음 행동을 안내한다.

### 사용자 흐름
```
결제 진행 → 결제 실패 → /payment/fail → 재시도 또는 다른 결제 수단
```

### 접근 조건
- **인증 필요**: No (또는 상황에 따라 Yes)
- **권한 수준**: guest
- **전제 조건**: 결제 실패 발생

---

## 2. 레이아웃 구조

### 와이어프레임

```
┌────────────────────────────────────────────────────────────┐
│ Header (minimal)                                           │
├────────────────────────────────────────────────────────────┤
│                                                            │
│                    ┌──────────────────┐                    │
│                    │                  │                    │
│                    │     💳❌ 아이콘   │                    │
│                    │                  │                    │
│                    │  결제에 실패했습니다│                    │
│                    │                  │                    │
│                    │  오류 원인:        │                    │
│                    │  "{에러 메시지}"   │                    │
│                    │                  │                    │
│                    │  ┌────────────┐  │                    │
│                    │  │ 다른 카드로 │  │                    │
│                    │  │   결제하기  │  │                    │
│                    │  └────────────┘  │                    │
│                    │                  │                    │
│                    │  [이전으로 돌아가기]│                    │
│                    │  [고객센터 문의]   │                    │
│                    │                  │                    │
│                    │  ─────────────── │                    │
│                    │  도움이 필요하신가요?│                   │
│                    │  • 카드 한도를 확인해주세요            │
│                    │  • 카드사에 문의해주세요               │
│                    │                  │                    │
│                    └──────────────────┘                    │
│                                                            │
└────────────────────────────────────────────────────────────┘
```

---

## 3. 컴포넌트 목록

### 3.1 에러 메시지 매핑

| Error Code | User Message |
|------------|--------------|
| CARD_DECLINED | "카드가 거부되었습니다. 카드사에 문의해주세요" |
| INSUFFICIENT_FUNDS | "잔액이 부족합니다" |
| CARD_EXPIRED | "카드 유효기간이 만료되었습니다" |
| INVALID_CARD | "카드 정보가 올바르지 않습니다" |
| LIMIT_EXCEEDED | "결제 한도를 초과했습니다" |
| TIMEOUT | "결제 처리 시간이 초과되었습니다" |
| CANCELLED | "결제가 취소되었습니다" |
| NETWORK_ERROR | "네트워크 연결을 확인해주세요" |
| SERVER_ERROR | "결제 처리 중 오류가 발생했습니다" |

### 3.2 도움말 섹션

**일반적인 해결 방법 안내**:
- 카드 한도 확인
- 다른 카드 사용
- 카드사 고객센터 연락
- TEE:UP 고객센터 연락

---

## 4. 데이터 요구사항

### URL Query Parameters

| Param | Type | Description |
|-------|------|-------------|
| error | string | 에러 코드 |
| orderId | string | 주문 ID (재시도용) |
| returnUrl | string | 원래 페이지 URL |

### 예시 URL

```
/payment/fail?error=CARD_DECLINED&orderId=ord_123&returnUrl=/pricing
```

---

## 5. 인터랙션 정의

### 5.1 다른 카드로 결제

1. **Given** 사용자가 결제 실패 페이지에 있을 때
2. **When** 다른 카드로 결제하기를 클릭하면
3. **Then** 결제 페이지로 돌아가서 새 카드 정보 입력

### 5.2 이전으로 돌아가기

1. **Given** 사용자가 결제를 포기하려 할 때
2. **When** 이전으로 돌아가기를 클릭하면
3. **Then** returnUrl로 이동 (또는 홈)

---

## 6. 접근성 요구사항

- [ ] 에러 메시지: role="alert", 명확한 설명
- [ ] 도움말 섹션: 접기/펼치기 가능 (aria-expanded)

---

## 7. 관련 화면

- **이전 화면**: 결제 페이지, [Pricing](../01-marketing/pricing.md)
- **연관 화면**: [Payment Success](./payment-success.md), [Booking Fail](./booking-fail.md)

---

## 8. 구현 메모

### TODO

- [ ] PaymentFailState 컴포넌트 구현 (BookingFail과 공유 가능)
- [ ] 에러 코드 → 메시지 매핑 (결제용)
- [ ] `/payment/fail/page.tsx` 구현
- [ ] Stripe/Toss 에러 코드 매핑
